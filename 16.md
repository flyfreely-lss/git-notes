# 代码合并之使用 `rebase` 整理提交历史

Git 中整合来自不同分支的修改有两种方式：`git merge` 和 `git rebase`。本文主要介绍 `rebase` 的两种使用方式和使用场景：

- Rebase
- 交互式的 rebase

## 1 Rebase

**使用场景**：分支合并--整合分叉的提交历史

**目的**是为了确保在向远程分支推送时能保持提交历史的整洁——例如向某个其他人维护的项目贡献代码时。 在这种情况下，你首先在自己的分支里进行开发，当开发完成时你需要先将你的代码变基到 `origin/master` 上，然后再向主项目提交修改。 这样的话，该项目的维护者就不再需要进行整合工作，只需要快进合并便可。

**命令使用**

```bash
git checkout feature
git rebase masters

# 回到 master 分支，进行一次快进合并。
git checkout master
git merge feature
```

它的**原理**是首先找到这两个分支（即当前分支 `experiment`、变基操作的目标基底分支 `master`） 的最近共同祖先 `C2`，然后对比当前分支相对于该祖先的历次提交，提取相应的修改并存为临时文件， 然后将当前分支指向目标基底 `C3`, 最后以此将之前另存为临时文件的修改依序应用。 

这两种整合方法的最终结果没有任何区别，但是变基使得提交历史更加整洁。 你在查看一个经过变基的分支的历史记录时会发现，尽管实际的开发工作是并行的， 但它们看上去就像是串行的一样，提交历史是一条直线没有分叉。

## 2 交互式的 rebase

分支整理--整理本地分支的提交历史（修改、压缩）

可以使用 `交互式的 rebase` 来变基一系列提交，通过给 `git rebase` 增加 `-i` 选项来交互式地运行变基。 一般被用于将 feature 分支并入 master 分支之前，清理混乱的历史。

主要介绍两种使用场景：

1. 压缩提交历史
2. 修改多个提交信息

### 2.1 压缩提交历史

将一连串提交压缩成一个单独的提交。

```bash
git rebase -i HEAD~3
```

注意其中的反序显示。 交互式变基给你一个它将会运行的脚本。 它将会从你在命令行中指定的提交（`HEAD~3`）开始，从上到下的依次重演每一个提交引入的修改。 它将最旧的而不是最新的列在上面，因为那会是第一个将要重演的。



### 2.2 修改多个提交信息

```bash

```



## 3 注意事项

要用它得遵守一条准则：

**如果提交存在于你的仓库之外，而别人可能基于这些提交进行开发，那么不要执行变基。**

