# 撤销操作之使用`revert`抵消提交

应用场景：当我们在 master 分支开发上线的功能有问题，需要马上撤回，这时候就可以考虑使用 `revert` 或 `reset`撤销我们之前的提交。可此时主分支上自己的提交后面还有别的同事的最新提交，为了不影响别人，需要考虑使用 `revert` 来撤销提交。

在 `Git` 的 `commit` 记录里，主要分两种类型的提交：
1. **普通类型的提交**
2. **合并类型的提交**

## 1 撤销普通类型的提交
```
git revert <commitId>
```
也可以使用如下命令撤销连续的commit:
```
# 撤销从 A-commitId 到 B-commitId 之间的提交
git revert <A-commitId>^..<B-commitId>

# 上行命令会自动生成多个新的commit，如果只用一个commit完成，可以这样写
git revert -n <A-commitId>^..<B-commitId> # -n参数表示不自动打开vim编辑器
git commit -m "revert A-commitId to B-commitId" # -m 参数后跟自定义的提交信息
```

## 2 撤销合并类型的提交
当我们用1中的命令撤销提交时，会发现报错了。这是因为该提交记录是通过 merge 别的 feature/fix 分支产生的，需要使用如下命令撤销：

```
# 撤销通过merge合并过来的提交。
git revert -m 1 <commitId> # -m 1 指出 mainline 需要被保留下来的父节点，此操作会撤销所有由父节点#2合并引入的修改，同时保留从父节点#1开始所有的内容。
```
当我们修复好bug后，需要再次将该 feature/fix 分支合并到 master，发现之前被 revert 的内容并没有合并过来，这是因为之前 feature/fix 分支的 commit 记录还保留在 master 分支记录中，从而忽略了相关的 commit。这时需要 revert 掉上面 revert 的合并提交。 操作如下：
```
git revert <revert-commitId>
```